<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Fractal Growth · Agents.jl Example Zoo</title><meta name="title" content="Fractal Growth · Agents.jl Example Zoo"/><meta property="og:title" content="Fractal Growth · Agents.jl Example Zoo"/><meta property="twitter:title" content="Fractal Growth · Agents.jl Example Zoo"/><meta name="description" content="Documentation for Agents.jl Example Zoo."/><meta property="og:description" content="Documentation for Agents.jl Example Zoo."/><meta property="twitter:description" content="Documentation for Agents.jl Example Zoo."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="https://fonts.googleapis.com/css?family=Montserrat|Source+Code+Pro&amp;display=swap" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Agents.jl Example Zoo logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Agents.jl Example Zoo</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../ants/">Ants</a></li><li><a class="tocitem" href="../battle/">Battle Royale</a></li><li><a class="tocitem" href="../social_distancing/">Continuous space social distancing</a></li><li><a class="tocitem" href="../game_of_life_2D_CA/">Conway&#39;s game of life</a></li><li><a class="tocitem" href="../growing_bacteria/">Bacterial Growth</a></li><li><a class="tocitem" href="../daisyworld/">Daisyworld</a></li><li><a class="tocitem" href="../forest_fire/">Forest fire</a></li><li class="is-active"><a class="tocitem" href>Fractal Growth</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Running-the-model"><span>Running the model</span></a></li></ul></li><li><a class="tocitem" href="../hk/">Hegselmann-Krause opinion dynamics</a></li><li><a class="tocitem" href="../maze/">Maze Solver</a></li><li><a class="tocitem" href="../runners/">Mountain Runners</a></li><li><a class="tocitem" href="../opinion_spread/">Opinion spread</a></li><li><a class="tocitem" href="../sugarscape/">Sugarscape</a></li><li><a class="tocitem" href="../taxsystem/">TaxSystem</a></li><li><a class="tocitem" href="../wealth_distribution/">Wealth distribution model</a></li><li><a class="tocitem" href="../wright-fisher/">Wright-Fisher model of evolution</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Fractal Growth</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Fractal Growth</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaDynamics/AgentsExampleZoo.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaDynamics/AgentsExampleZoo.jl/blob/main/docs/examples/fractal_growth.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Fractal-Growth"><a class="docs-heading-anchor" href="#Fractal-Growth">Fractal Growth</a><a id="Fractal-Growth-1"></a><a class="docs-heading-anchor-permalink" href="#Fractal-Growth" title="Permalink"></a></h1><video width="auto" controls autoplay loop>
<source src="../fractal.mp4" type="video/mp4">
</video><p>This model follows the process known as diffusion-limited aggregation to simulate the growth of fractals. It is a kinetic process that consists of Randomly() diffusing particles giving rise to fractal-like structures resembling those observed naturally. This examplet is based off of <a href="https://www.complexity-explorables.org/explorables/particularly-stuck/">&quot;Particularly Stuck&quot; example</a> in Complexity Explorables.</p><p>The environment is a two dimensional, continuous space world. Agents are particles that diffuse and aggregate to form fractals. Initially, there are particles of random size distributed across the space, and one static particle in the center that forms the seed for the fractal growth. As moving particles collide with the seed or any particle that previously collided with the seed, it gets stuck and contributes to the fractal. As a particle gets stuck, another one is created at a circular border around the center to feed the growth.</p><p>It is also available from the <code>Models</code> module as <a href="@ref"><code>Models.fractal_growth</code></a>.</p><pre><code class="language-julia hljs">using Agents, LinearAlgebra
using Random</code></pre><p>We use the <a href="@ref"><code>@agent</code></a> macro to conveniently define a <code>Particle</code> agent. Each agent has a radius, representing the particle size, a boolean to define whether it is stuck and part of the fractal, and an axis around which it spins (elaborated on later). In addition, since we use the <a href="@ref"><code>ContinuousAgent</code></a> type, the <a href="@ref"><code>@agent</code></a> macro also provides each agent with fields for <code>id</code>, <code>pos</code> (its position in space) and <code>vel</code> (its velocity).</p><pre><code class="language-julia hljs">@agent struct Particle(ContinuousAgent{2, Float64})
    radius::Float64
    is_stuck::Bool
    spin_axis::Array{Float64,1}
end

propParticle(radius::Float64, spin_clockwise::Bool; is_stuck = false,) =
    ((0.0, 0.0), radius, is_stuck, [0.0, 0.0, spin_clockwise ? -1.0 : 1.0])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">propParticle (generic function with 1 method)</code></pre><p>We also define a few utility functions for ease of implementation. <code>rand_circle</code> returns a random point on the unit circle. <code>particle_radius</code> generates a random radius for a particle, within given range defined by <code>min_radius</code> and <code>max_radius</code>. If <code>max_radius &lt; min_radius</code>, it returns <code>min_radius</code>: allowing a fixed particle size to be specified.</p><pre><code class="language-julia hljs">rand_circle(rng) = (θ = rand(rng, 0.0:0.1:359.9); (cos(θ), sin(θ)))
particle_radius(min_radius::Float64, max_radius::Float64, rng) =
    min_radius &lt;= max_radius ? rand(rng, min_radius:0.01:max_radius) : min_radius</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">particle_radius (generic function with 1 method)</code></pre><p>The <code>initialize_model</code> function returns a new model containing particles placed Randomly() in the given space and one seed particle at the center.</p><pre><code class="language-julia hljs">function initialize_model(;
    initial_particles::Int = 100, # initial particles in the model, not including the seed
    # size of the space in which particles exist
    space_extents::NTuple{2,Float64} = (150.0, 150.0),
    speed = 0.5, # speed of particle movement
    vibration = 0.55, # amplitude of particle vibration
    attraction = 0.45, # velocity of particles towards the center
    spin = 0.55, # tangential velocity with which particles orbit the center
    # fraction of particles orbiting clockwise. The rest are anticlockwise
    clockwise_fraction = 0.0,
    min_radius = 1.0, # minimum radius of any particle
    max_radius = 2.0, # maximum radius of any particle
    seed = 42,
)
    properties = Dict(
        :speed =&gt; speed,
        :vibration =&gt; vibration,
        :attraction =&gt; attraction,
        :spin =&gt; spin,
        :clockwise_fraction =&gt; clockwise_fraction,
        :min_radius =&gt; min_radius,
        :max_radius =&gt; max_radius,
        :spawn_count =&gt; 0,
    )
    # space is periodic to allow particles going off one edge to wrap around to the opposite
    space = ContinuousSpace(space_extents; spacing = 1.0, periodic = true)
    model = ABM(Particle, space; properties, agent_step!, model_step!,
                rng = MersenneTwister(seed))
    center = space_extents ./ 2.0
    for i in 1:initial_particles
        radius = particle_radius(min_radius, max_radius, abmrng(model))
        props = propParticle(radius, rand(abmrng(model)) &lt; clockwise_fraction)
        # `add_agent!` automatically gives the particle a random position in the space
        add_agent!(model, props...)
    end
    # create the seed particle
    radius = particle_radius(min_radius, max_radius, abmrng(model))
    props_seed_particle = propParticle(radius, true; is_stuck = true)
    # `add_agent_pos!` will use the position of the agent passed in, instead of assigning it
    # to a random value
    add_agent!(center, model, props_seed_particle...)
    return model
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">initialize_model (generic function with 1 method)</code></pre><p>The <code>agent_step!</code> function simulates particle motion for those who are not yet <code>stuck</code>. For each particle, we first perform a crude distance check to all other particles. If the current particle intersects any particle in the fractal, it also becomes part of the fractal and is not simulated further. Agent velocity has a radial component that attracts it towards the center, a tangential component that makes it orbit around the center, and a random component that simulates vibration of the particle. The velocity is scaled to be inversely proportional to the square of the particle&#39;s radius, so that larger particles move slower. The <code>speed</code> parameter is implemented as the time difference between successive steps of the simulation. A larger value causes particles to move more per step, but leads to inaccuracies as particles do not move through the intervening space.</p><pre><code class="language-julia hljs">function agent_step!(agent::Particle, model)
    agent.is_stuck &amp;&amp; return

    for id in nearby_ids(agent.pos, model, agent.radius)
        if model[id].is_stuck
            agent.is_stuck = true
            # increment count to make sure another particle is spawned as this one gets stuck
            model.spawn_count += 1
            return
        end
    end
    # radial vector towards the center of the space
    radial = abmspace(model).extent ./ 2.0 .- agent.pos
    radial = radial ./ norm(radial)
    # tangential vector in the direction of orbit of the particle
    tangent = Tuple(cross([radial..., 0.0], agent.spin_axis)[1:2])
    agent.vel =
        (
            radial .* model.attraction .+ tangent .* model.spin .+
            rand_circle(abmrng(model)) .* model.vibration
        ) ./ (agent.radius^2.0)
    move_agent!(agent, model, model.speed)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">agent_step! (generic function with 1 method)</code></pre><p>The <code>model_step!</code> function serves the sole purpose of spawning additional particles as they get stuck to the growing fractal.</p><pre><code class="language-julia hljs">function model_step!(model)
    while model.spawn_count &gt; 0
        radius = particle_radius(model.min_radius, model.max_radius, abmrng(model))
        props = propParticle(radius, rand(abmrng(model)) &lt; model.clockwise_fraction)
        pos = (rand_circle(abmrng(model)) .+ 1.0) .* abmspace(model).extent .* 0.49
        add_agent!(pos, model, props...)
        model.spawn_count -= 1
    end
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">model_step! (generic function with 1 method)</code></pre><h1 id="Running-the-model"><a class="docs-heading-anchor" href="#Running-the-model">Running the model</a><a id="Running-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-model" title="Permalink"></a></h1><p>We run the model using the <code>InteractiveDynamics</code> package with <code>GLMakie</code> backend so the fractal growth can be visualised as it happens. <code>InteractiveDynamics</code> provides the <code>abmvideo</code> function to easily record a video of the simulation running.</p><pre><code class="language-julia hljs">model = initialize_model()

using CairoMakie</code></pre><p>Particles that are stuck and part of the fractal are shown in red, for visual distinction</p><pre><code class="language-julia hljs">particle_color(a::Particle) = a.is_stuck ? :red : :blue</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">particle_color (generic function with 1 method)</code></pre><p>The visual size of particles corresponds to their radius, and has been calculated for the default value of <code>space_extents</code> of the <code>initialize_model</code> function. It will not look accurate on other values.</p><pre><code class="language-julia hljs">particle_size(a::Particle) = 7.5 * a.radius

abmvideo(
    &quot;fractal.mp4&quot;,
    model;
    agent_color = particle_color,
    agent_size = particle_size,
    agent_marker = &#39;●&#39;,
    spf = 20,
    frames = 60,
    framerate = 25,
    title = &quot;Fractal Growth&quot;,
    agentsplotkwargs = (strokewidth = 0.5, strokecolor = :white),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr33"><span class="sgr1">┌ Warning: </span></span>keyword `spf` is deprecated in favor of `dt`.
<span class="sgr33"><span class="sgr1">└ </span></span><span class="sgr90">@ AgentsVisualizations ~/.julia/packages/Agents/eKASH/ext/AgentsVisualizations/src/convenience.jl:102</span></code></pre><video width="auto" controls autoplay loop>
<source src="../fractal.mp4" type="video/mp4">
</video></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../forest_fire/">« Forest fire</a><a class="docs-footer-nextpage" href="../hk/">Hegselmann-Krause opinion dynamics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Sunday 13 October 2024 09:05">Sunday 13 October 2024</span>. Using Julia version 1.11.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
